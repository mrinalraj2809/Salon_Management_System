CREATE TABLE CUSTOMER(
    PHONE_NO        INTEGER,
    F_NAME          VARCHAR(8) NOT NULL,
    L_NAME          VARCHAR(8),
    GENDER          CHAR(1),
    C_ADDRESS       VARCHAR(11),
                    CONSTRAINT CHECK_PHONE CHECK (LENGTH(PHONE_NO)>=10 AND LENGTH(PHONE_NO)<=12),
                    CONSTRAINT CHECK_GENDER CHECK(GENDER in ('M', 'F', 'O')),
                    CONSTRAINT C_PK_1 PRIMARY KEY(PHONE_NO)
);

CREATE TABLE EMPLOYEE(
    PHONE_NO        INTEGER,
    F_NAME          VARCHAR(8) NOT NULL,
    L_NAME          VARCHAR(8),
    DOB             DATE,
    GENDER          CHAR(1) ,
    RATE_OF_PAY     NUMBER(4,2),
    E_ADDRESS       VARCHAR(11),
                    CONSTRAINT CHECK_PHONE_EMPLOYEE CHECK (LENGTH(PHONE_NO)>=10 AND LENGTH(PHONE_NO)<=12),
                    CONSTRAINT CHECK_GENDER_EMPLOYEE CHECK (GENDER in ('M', 'F', 'O')),
                    CONSTRAINT E_PK_1 PRIMARY KEY(PHONE_NO)
);

CREATE TABLE APPOINTMENT(
    APPOINTMENT_ID      VARCHAR(8) NOT NULL,
    APPOINTMENT_DATE    DATE,
    CUSTOMER_ID         INTEGER ,
    SECURITY_DEPOSIT    NUMBER,
    SECONDARY_PAY_LEFT  NUMBER,
                    CONSTRAINT A_PK_1 PRIMARY KEY(APPOINTMENT_ID),
                    CONSTRAINT A_FK_1 FOREIGN KEY(CUSTOMER_ID) REFERENCES CUSTOMER(PHONE_NO)              
);

CREATE TABLE SERVICES(
    SERVICE_ID          VARCHAR(8) NOT NULL,
    SERVICE_NAME        VARCHAR(12) NOT NULL,
    DURATION_MIN        INTEGER,
    SERVICE_CHARGE      NUMBER(4,2),
    AVAILABILITY        INTEGER,
                    CONSTRAINT S_PK_1 PRIMARY KEY(SERVICE_ID)
);


CREATE TABLE MATERIAL(
    MATERIAL_ID         VARCHAR(12),
    MATERIAL_NAME       VARCHAR(15),
    AVAILABILITY        INTEGER,
    PRICE               NUMBER(5,2),
                    CONSTRAINT M_PK_1 PRIMARY KEY(MATERIAL_ID)
);
ALTER TABLE SERVICES ADD CONSTRAINT S_FK_1 FOREIGN KEY(MATERIAL_ID) REFERENCES MATERIAL(MATERIAL_ID);

CREATE TABLE USES(
    SERVICE_ID          VARCHAR(8),
    MATERIAL_ID         VARCHAR(12),
                    CONSTRAINT USES_FK_1 FOREIGN KEY(SERVICE_ID) REFERENCES SERVICES(SERVICE_ID),
                    CONSTRAINT USES_FK_2 FOREIGN KEY(MATERIAL_ID) REFERENCES MATERIAL(MATERIAL_ID)
);


CREATE TABLE SERVICE_RENDERED(
    APPOINTMENT_ID      VARCHAR(15),
    SERVICE_ID          VARCHAR(8),
    EMPLOYEE_ID         NUMBER(12),
    EXTENDED_PRICE      NUMBER(5,2),
                    CONSTRAINT SR_FK1 FOREIGN KEY(APPOINTMENT_ID) REFERENCES APPOINTMENT(APPOINTMENT_ID),
                    CONSTRAINT SR_FK2 FOREIGN KEY(SERVICE_ID) REFERENCES SERVICES(SERVICE_ID),
                    CONSTRAINT SR_FK3 FOREIGN KEY(EMPLOYEE_ID) REFERENCES CUSTOMER(PHONE_NO),
                    CONSTRAINT SR_PK1 PRIMARY KEY(APPOINTMENT_ID,SERVICE_ID)
);

CREATE TABLE BILLINGS(
    BILL_ID                 VARCHAR(15),
    TOTAL_AMOUNT            NUMBER(7,2),
    BILL_DATE               DATE,
    TAX_AMOUNT              NUMBER(7,2),
    SELLER_AMOUNT_BALANCE   NUMBER(7,2),
    APPOINTMENT_ID          VARCHAR(15),
    EMPLOYEE_ID             NUMBER(12),
    DISCOUNT                NUMBER(7,2),
                    CONSTRAINT B_PK_1 PRIMARY KEY(BILL_ID),
                    CONSTRAINT B_FK_1 FOREIGN KEY(EMPLOYEE_ID) REFERENCES EMPLOYEE(PHONE_NO),
                    CONSTRAINT B_FK_2 FOREIGN KEY(APPOINTMENT_ID) REFERENCES APPOINTMENT(APPOINTMENT_ID)
);

//SET TRIGGER ON AVAILABILITY OF SERVICES TABLE

/*ALTER TABLE SERVICES ADD*/  TO ADD MATERIAL ID

INSERT INTO CUSTOMER VALUES(9470243913,'MRINAL','RAJ','M','M.G. BLOCK');
INSERT INTO CUSTOMER VALUES(7619106154,'MOHIT','SAH','M','BVB BLOCK');
INSERT INTO CUSTOMER VALUES(9886432160,'MOHIT','HOME','M','NEPAL');
INSERT INTO CUSTOMER VALUES(7070549002,'MRIGANK','SRIVASTAVA','M','TUMKUR');
INSERT INTO CUSTOMER VALUES(9113530409,'MRIGANK','HOME','F','PATNA');
INSERT INTO CUSTOMER VALUES(8296707225,'ANISH','','M','BHAGALPUR');


